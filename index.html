<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="robots" content="noindex,nofollow">
    <title>ç¢³å‰ TanJi - CCUS æ·¨é›¶æ±ºç­–æ¨¡æ“¬å™¨</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; overscroll-behavior-y: none; }
        /* æ»‘æ¡¿æ¨£å¼å„ªåŒ– */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%;
            background: #ffffff; border: 2px solid currentColor; cursor: pointer; margin-top: -10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #e2e8f0; border-radius: 9999px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .site-card { transition: all 0.2s; }
        .site-card:active { transform: scale(0.96); }
        .dashboard-enter { animation: slideUp 0.5s ease-out forwards; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .glow-text { text-shadow: 0 0 10px rgba(255,255,255,0.5); }
        
        /* é–å®šç‹€æ…‹çš„æ»‘æ¡¿ */
        input[type=range]:disabled { opacity: 0.5; cursor: not-allowed; }
        input[type=range]:disabled::-webkit-slider-thumb { border-color: #cbd5e1; background: #f1f5f9; box-shadow: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-[100dvh] flex flex-col overflow-hidden">

    <!-- ç™»å…¥ç•«é¢ -->
    <div id="login-screen" class="fixed inset-0 bg-slate-900 z-50 flex flex-col items-center justify-center p-6 text-white transition-opacity duration-500">
        <div class="w-16 h-16 bg-emerald-500 rounded-2xl flex items-center justify-center mb-6 shadow-2xl shadow-emerald-500/50">
            <i data-lucide="leaf" class="w-8 h-8 text-white"></i>
        </div>
        <h1 class="text-3xl font-black mb-2 tracking-tight">ç¢³å‰ TanJi</h1>
        <p class="text-slate-400 mb-8 text-sm">CCUS æ·¨é›¶æ±ºç­–æ¨¡æ“¬ç³»çµ±</p>
        
        <div class="w-full max-w-sm space-y-4">
            <div>
                <label class="text-xs font-bold text-slate-400 uppercase ml-1">å°çµ„åç¨± / æ•™å¸«ä»£ç¢¼</label>
                <input type="text" id="login-team" placeholder="è¼¸å…¥å°çµ„åç¨±" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 mt-1 text-white font-bold focus:ring-2 focus:ring-emerald-500 outline-none transition-all">
            </div>
            
            <div id="role-selector" class="transition-all duration-300">
                <label class="text-xs font-bold text-slate-400 uppercase ml-1">é¸æ“‡æ‚¨çš„è§’è‰²</label>
                <div class="grid grid-cols-2 gap-2 mt-1">
                    <button onclick="selectRole('engineer')" class="role-btn bg-slate-800 border border-slate-700 p-3 rounded-xl text-left hover:border-emerald-500 transition-all group" data-role="engineer">
                        <div class="text-xl mb-1">ğŸ”§</div>
                        <div class="text-xs font-bold text-slate-300 group-hover:text-white">ç’°å¢ƒå·¥ç¨‹å¸«</div>
                    </button>
                    <button onclick="selectRole('cfo')" class="role-btn bg-slate-800 border border-slate-700 p-3 rounded-xl text-left hover:border-emerald-500 transition-all group" data-role="cfo">
                        <div class="text-xl mb-1">ğŸ’°</div>
                        <div class="text-xs font-bold text-slate-300 group-hover:text-white">è²¡å‹™é•·</div>
                    </button>
                    <button onclick="selectRole('pr')" class="role-btn bg-slate-800 border border-slate-700 p-3 rounded-xl text-left hover:border-emerald-500 transition-all group" data-role="pr">
                        <div class="text-xl mb-1">ğŸ“¢</div>
                        <div class="text-xs font-bold text-slate-300 group-hover:text-white">å…¬é—œç¶“ç†</div>
                    </button>
                    <button onclick="selectRole('eco')" class="role-btn bg-slate-800 border border-slate-700 p-3 rounded-xl text-left hover:border-emerald-500 transition-all group" data-role="eco">
                        <div class="text-xl mb-1">ğŸŒ±</div>
                        <div class="text-xs font-bold text-slate-300 group-hover:text-white">ç”Ÿæ…‹ä¿è‚²å“¡</div>
                    </button>
                    <button onclick="selectRole('policy')" class="role-btn bg-slate-800 border border-slate-700 p-3 rounded-xl text-left hover:border-emerald-500 transition-all group col-span-2" data-role="policy">
                        <div class="text-xl mb-1 flex items-center gap-2">ğŸ“œ <span class="text-xs bg-emerald-900 text-emerald-400 px-1.5 rounded">éšŠé•·</span></div>
                        <div class="text-xs font-bold text-slate-300 group-hover:text-white">æ”¿ç­–åˆ†æå¸«</div>
                    </button>
                </div>
            </div>

            <button id="start-btn" onclick="enterSimulation()" disabled class="w-full bg-slate-700 text-slate-500 py-4 rounded-xl font-bold mt-4 transition-all shadow-lg">
                ç³»çµ±è¼‰å…¥ä¸­...
            </button>
        </div>
    </div>

    <!-- é ‚éƒ¨å°èˆª -->
    <nav class="bg-white shadow-sm border-b border-slate-200 flex-none z-30">
        <div class="container mx-auto px-4 h-14 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center text-emerald-600">
                    <i data-lucide="leaf" class="w-5 h-5"></i>
                </div>
                <div>
                    <h1 class="text-base font-bold text-slate-800">ç¢³å‰ TanJi</h1>
                    <p class="text-[10px] text-slate-500 font-bold" id="header-team-info">æœªç™»å…¥</p>
                </div>
            </div>
            <div id="connection-indicator" class="flex items-center gap-1.5 px-2 py-1 bg-slate-100 rounded-full">
                <div class="w-2 h-2 bg-slate-400 rounded-full"></div>
                <span class="text-[10px] font-bold text-slate-500">é€£ç·šä¸­...</span>
            </div>
        </div>
    </nav>

    <!-- ä¸»å…§å®¹å€ (å­¸ç”Ÿæ¨¡æ“¬å™¨) -->
    <main id="main-student" class="flex-1 overflow-y-auto p-4 pb-40 no-scrollbar relative hidden">
        <div class="container mx-auto max-w-5xl grid grid-cols-1 lg:grid-cols-12 gap-6">
            <!-- å·¦å´ï¼šæ±ºç­–é¢æ¿ -->
            <div class="lg:col-span-7 space-y-4">
                <!-- é¸å€å€å¡Š -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden relative">
                    <div class="px-4 py-2 bg-slate-50 border-b border-slate-100 flex justify-between items-center">
                        <h2 class="text-sm font-bold text-slate-700">1. é¸å€æ±ºç­–</h2>
                        <span class="text-[10px] bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded font-bold">ğŸ“œ æ”¿ç­–åˆ†æå¸«</span>
                    </div>
                    <div class="p-3 grid grid-cols-3 gap-2">
                        <button onclick="updateTeamState('site', 'A')" id="btn-A" class="site-card p-3 rounded-xl border-2 border-slate-100 text-center"><div class="text-2xl mb-1">ğŸŒŠ</div><div class="text-xs font-bold">å¤–æµ·</div></button>
                        <button onclick="updateTeamState('site', 'B')" id="btn-B" class="site-card p-3 rounded-xl border-2 border-slate-100 text-center"><div class="text-2xl mb-1">ğŸ­</div><div class="text-xs font-bold">å·¥æ¥­å€</div></button>
                        <button onclick="updateTeamState('site', 'C')" id="btn-C" class="site-card p-3 rounded-xl border-2 border-slate-100 text-center"><div class="text-2xl mb-1">â›°ï¸</div><div class="text-xs font-bold">æ·±å±±</div></button>
                    </div>
                    <!-- é–å®šé®ç½© -->
                    <div id="lock-site" class="absolute inset-0 bg-white/60 backdrop-blur-[1px] flex items-center justify-center z-10 hidden cursor-not-allowed"><span class="text-xs font-bold text-slate-400 bg-white px-2 py-1 rounded border shadow-sm">ğŸ”’ åƒ…åˆ†æå¸«å¯æ“ä½œ</span></div>
                </div>

                <!-- è³‡æºé…ç½®å€å¡Š -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-4 relative overflow-hidden">
                        <div class="flex justify-between mb-2 items-center"><label class="text-sm font-bold text-slate-700 flex gap-1"><i data-lucide="shield-check" class="w-4 h-4 text-blue-500"></i> å®‰å…¨ç›£æ¸¬</label><span class="text-[10px] bg-blue-100 text-blue-600 px-2 py-0.5 rounded font-bold">ğŸ”§ å·¥ç¨‹å¸«</span></div>
                        <input type="range" min="1" max="5" value="3" id="slider-safety" class="text-blue-500" oninput="updateTeamState('safety', this.value)">
                        <div class="flex justify-between text-[10px] text-slate-400 mt-2"><span>ä½</span><span id="val-safety" class="font-bold text-blue-600">æ¨™æº–</span><span>é«˜</span></div>
                        <div id="lock-safety" class="absolute inset-0 bg-white/60 z-10 hidden flex items-center justify-center"><i data-lucide="lock" class="w-4 h-4 text-slate-400"></i></div>
                    </div>
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-4 relative overflow-hidden">
                        <div class="flex justify-between mb-2 items-center"><label class="text-sm font-bold text-slate-700 flex gap-1"><i data-lucide="coins" class="w-4 h-4 text-amber-500"></i> å›é¥‹é‡‘</label><span class="text-[10px] bg-amber-100 text-amber-600 px-2 py-0.5 rounded font-bold">ğŸ“¢ å…¬é—œ</span></div>
                        <input type="range" min="1" max="5" value="2" id="slider-pr" class="text-amber-500" oninput="updateTeamState('pr', this.value)">
                        <div class="flex justify-between text-[10px] text-slate-400 mt-2"><span>å°‘</span><span id="val-pr" class="font-bold text-amber-600">æ¨™æº–</span><span>å¤š</span></div>
                        <div id="lock-pr" class="absolute inset-0 bg-white/60 z-10 hidden flex items-center justify-center"><i data-lucide="lock" class="w-4 h-4 text-slate-400"></i></div>
                    </div>
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-4 relative overflow-hidden">
                        <div class="flex justify-between mb-2 items-center"><label class="text-sm font-bold text-slate-700 flex gap-1"><i data-lucide="sprout" class="w-4 h-4 text-emerald-500"></i> ç”Ÿæ…‹è£œå„Ÿ</label><span class="text-[10px] bg-emerald-100 text-emerald-600 px-2 py-0.5 rounded font-bold">ğŸŒ± ç”Ÿæ…‹å“¡</span></div>
                        <input type="range" min="1" max="5" value="2" id="slider-eco" class="text-emerald-500" oninput="updateTeamState('eco', this.value)">
                        <div class="flex justify-between text-[10px] text-slate-400 mt-2"><span>åŸºæœ¬</span><span id="val-eco" class="font-bold text-emerald-600">æ¨™æº–</span><span>åš´æ ¼</span></div>
                        <div id="lock-eco" class="absolute inset-0 bg-white/60 z-10 hidden flex items-center justify-center"><i data-lucide="lock" class="w-4 h-4 text-slate-400"></i></div>
                    </div>
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-4 relative overflow-hidden">
                        <div class="flex justify-between mb-2 items-center"><label class="text-sm font-bold text-slate-700 flex gap-1"><i data-lucide="piggy-bank" class="w-4 h-4 text-rose-500"></i> é ç®—ç·Šç¸®</label><span class="text-[10px] bg-rose-100 text-rose-600 px-2 py-0.5 rounded font-bold">ğŸ’° è²¡å‹™é•·</span></div>
                        <input type="range" min="1" max="5" value="2" id="slider-cfo" class="text-rose-500" oninput="updateTeamState('cfo', this.value)">
                        <div class="flex justify-between text-[10px] text-slate-400 mt-2"><span>å¯¬é¬†</span><span id="val-cfo" class="font-bold text-rose-600">æ¨™æº–</span><span>åš´æ ¼</span></div>
                        <div id="lock-cfo" class="absolute inset-0 bg-white/60 z-10 hidden flex items-center justify-center"><i data-lucide="lock" class="w-4 h-4 text-slate-400"></i></div>
                    </div>
                </div>
            </div>

            <!-- å³å´ï¼šå„€è¡¨æ¿ -->
            <div class="lg:col-span-5 space-y-4">
                <div class="bg-white rounded-2xl shadow-lg border border-slate-100 p-4">
                    <div class="flex justify-between items-center mb-2"><h3 class="font-bold text-slate-800">SROI é æ¸¬æ¨¡å‹</h3><span class="text-[10px] text-slate-400">Team Sync Active</span></div>
                    <div class="h-[200px] relative"><canvas id="radarChart"></canvas></div>
                    <div class="mt-3 space-y-1">
                        <div class="flex justify-between text-xs border-b border-slate-50 pb-1"><span class="text-slate-500">å®‰å…¨æ€§ (Safety)</span><span id="score-safety" class="font-bold text-blue-600">0</span></div>
                        <div class="flex justify-between text-xs border-b border-slate-50 pb-1"><span class="text-slate-500">ç¶“æ¿Ÿæ€§ (Economy)</span><span id="score-economy" class="font-bold text-amber-600">0</span></div>
                        <div class="flex justify-between text-xs"><span class="text-slate-500">ç¤¾æœƒæ€§ (Social)</span><span id="score-social" class="font-bold text-emerald-600">0</span></div>
                    </div>
                </div>
                <div class="bg-slate-800 p-4 rounded-xl border border-slate-700">
                    <h4 class="text-xs font-bold text-emerald-400 mb-2 flex items-center gap-1"><i data-lucide="terminal" class="w-3 h-3"></i> å³æ™‚å”ä½œç´€éŒ„</h4>
                    <div id="system-log" class="text-xs text-slate-400 h-24 overflow-y-auto space-y-1 font-mono">
                        <div>> ç³»çµ±åˆå§‹åŒ–å®Œæˆ...</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- æ•™å¸«ç¸½è¦½æˆ°æƒ…å®¤ (Admin Dashboard) -->
    <main id="main-admin" class="flex-1 overflow-y-auto p-4 md:p-8 no-scrollbar relative hidden bg-slate-900 text-white">
        <div class="container mx-auto max-w-7xl">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-blue-500">å…¨ç­æ±ºç­–ç¸½è¦½</h2>
                    <p class="text-slate-400 text-sm mt-1">å³æ™‚ç›£æ§å„çµ„æ±ºç­–å‹•æ…‹èˆ‡ SROI è¡¨ç¾</p>
                </div>
                <div class="flex items-center gap-4">
                    <div class="bg-slate-800 px-4 py-2 rounded-lg border border-slate-700">
                        <span class="text-xs text-slate-400 block">åœ¨ç·šçµ„æ•¸</span>
                        <span class="text-xl font-bold text-emerald-400" id="admin-team-count">0</span>
                    </div>
                    <button onclick="clearAllData()" class="bg-red-500/20 hover:bg-red-500/40 text-red-400 px-4 py-2 rounded-lg border border-red-500/50 transition-colors flex items-center gap-2">
                        <i data-lucide="trash-2" class="w-4 h-4"></i> é‡ç½®èª²ç¨‹
                    </button>
                </div>
            </div>

            <!-- å…¨ç­çµ±è¨ˆ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                    <h3 class="font-bold text-slate-300 mb-4 flex items-center gap-2"><i data-lucide="pie-chart" class="w-4 h-4"></i> é¸å€åˆ†ä½ˆ</h3>
                    <div class="h-[200px] relative"><canvas id="adminPieChart"></canvas></div>
                </div>
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                    <h3 class="font-bold text-slate-300 mb-4 flex items-center gap-2"><i data-lucide="bar-chart-2" class="w-4 h-4"></i> å¹³å‡æŒ‡æ¨™</h3>
                    <div class="h-[200px] relative"><canvas id="adminBarChart"></canvas></div>
                </div>
                <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                    <h3 class="font-bold text-slate-300 mb-4 flex items-center gap-2"><i data-lucide="trophy" class="w-4 h-4"></i> æ’è¡Œæ¦œ</h3>
                    <div class="overflow-y-auto h-[200px] space-y-2 pr-2" id="leaderboard"></div>
                </div>
            </div>

            <!-- å„çµ„å¡ç‰‡ -->
            <h3 class="font-bold text-slate-300 mb-4 flex items-center gap-2"><i data-lucide="grid" class="w-4 h-4"></i> å„çµ„å³æ™‚ç‹€æ…‹</h3>
            <div id="team-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
        </div>
    </main>

    <!-- åº•éƒ¨æ“ä½œå€ (å­¸ç”Ÿç”¨) -->
    <div id="student-footer" class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur border-t border-slate-200 p-4 z-40 shadow hidden">
        <div class="container mx-auto max-w-5xl flex justify-between items-center">
            <div class="flex flex-col">
                <div class="text-[10px] text-slate-400 uppercase font-bold tracking-widest">SROI ç¶œåˆè©•åˆ†</div>
                <div class="text-4xl font-black text-slate-800 leading-none tabular-nums" id="footer-score">0.0</div>
            </div>
            <div id="submit-wrapper" class="relative">
                <button onclick="submitFinalDecision()" id="submit-btn" class="bg-slate-900 hover:bg-slate-800 text-white px-8 py-3 rounded-xl font-bold shadow-lg transition-all flex items-center gap-2 active:scale-95">
                    æäº¤æ±ºç­– <i data-lucide="send" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, serverTimestamp, collection, addDoc, getDocs, deleteDoc, query, orderBy } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ================= CONFIG =================
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyDMBE9BjTJb70xm8c5WOZaIITxI0PmYWNc",
            authDomain: "tanji-ccus.firebaseapp.com",
            projectId: "tanji-ccus",
            storageBucket: "tanji-ccus.firebasestorage.app",
            messagingSenderId: "118576059306",
            appId: "1:118576059306:web:8f1c7e87b49d4d388651d3"
        };
        
        let db, auth, currentUser, unsubscribe;
        // é è¨­ appId
        const appId = typeof __app_id !== 'undefined' ? __app_id : "tanji-ccus-v1";

        // ç‹€æ…‹ç®¡ç†
        window.userState = { team: "", role: "", isAdmin: false };
        window.teamState = { site: "A", safety: 3, pr: 2, eco: 2, cfo: 2, lastLog: "" };
        let isDemoMode = false; // é›¢ç·š/é«”é©—æ¨¡å¼æ——æ¨™

        // åˆå§‹åŒ–
        async function initApp() {
            try {
                if (!firebaseConfig || !firebaseConfig.apiKey) {
                    throw new Error("Missing Firebase Config");
                }
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                
                // å„ªå…ˆæª¢æŸ¥æ˜¯å¦æœ‰ token
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    try {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } catch (err) {
                        console.warn("Custom token failed, trying anonymous");
                        await signInAnonymously(auth);
                    }
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUser = user;
                        enableOnlineMode();
                    } else {
                        // ç†è«–ä¸Šä¸æœƒç™¼ç”Ÿï¼Œä½†ä»¥é˜²è¬ä¸€
                        startDemoMode("Auth State Null");
                    }
                });
            } catch (e) {
                console.error("Firebase init failed:", e);
                startDemoMode(e.message);
            }
        }
        
        function enableOnlineMode() {
            isDemoMode = false;
            document.getElementById('connection-indicator').innerHTML = `<div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div><span class="text-[10px] font-bold text-green-600">å·²é€£ç·š</span>`;
            const startBtn = document.getElementById('start-btn');
            // å¦‚æœé‚„å¡åœ¨ã€Œç³»çµ±è¼‰å…¥ä¸­...ã€æˆ–ã€Œé€£ç·šå¤±æ•—ã€ï¼Œé‡ç½®å®ƒ
            if (startBtn.innerText === "ç³»çµ±è¼‰å…¥ä¸­..." || startBtn.innerText.includes("é›¢ç·š")) {
                startBtn.disabled = true;
                startBtn.className = "w-full bg-slate-700 text-slate-500 py-4 rounded-xl font-bold mt-4 transition-all shadow-lg";
                startBtn.innerText = "è«‹è¼¸å…¥å°çµ„åç¨±";
                checkLoginInput(); // é‡æ–°æª¢æŸ¥è¼¸å…¥ç‹€æ…‹
            }
        }

        function startDemoMode(reason) {
            console.warn("Switching to DEMO MODE due to:", reason);
            isDemoMode = true;
            currentUser = { uid: 'demo-user', isAnonymous: true }; // Mock User
            
            document.getElementById('connection-indicator').innerHTML = `<div class="w-2 h-2 bg-amber-500 rounded-full"></div><span class="text-[10px] font-bold text-amber-600">é«”é©—æ¨¡å¼(é›¢ç·š)</span>`;
            
            const startBtn = document.getElementById('start-btn');
            if (startBtn.innerText === "ç³»çµ±è¼‰å…¥ä¸­..." || startBtn.innerText === "é€£ç·šå¤±æ•—ï¼Œè«‹é‡æ•´") {
                startBtn.disabled = true;
                startBtn.className = "w-full bg-slate-700 text-slate-500 py-4 rounded-xl font-bold mt-4 transition-all shadow-lg";
                startBtn.innerText = "è«‹è¼¸å…¥å°çµ„åç¨±";
                checkLoginInput();
            }
        }
        
        initApp();

        // è§’è‰²é¸æ“‡é‚è¼¯
        window.selectRole = (role) => {
            window.userState.role = role;
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-emerald-500', 'bg-emerald-900', 'bg-emerald-50');
                btn.classList.add('bg-slate-800');
            });
            const selectedBtn = document.querySelector(`button[data-role="${role}"]`);
            if (selectedBtn) {
                selectedBtn.classList.remove('bg-slate-800');
                selectedBtn.classList.add('ring-2', 'ring-emerald-500', 'bg-emerald-900');
            }
            checkLoginInput();
        };

        // å³æ™‚æª¢æŸ¥è¼¸å…¥æ¡† (ä¿®æ­£å¾Œï¼šç§»é™¤å° Auth ç‹€æ…‹çš„ä¾è³´ï¼Œå…è¨±ç›´æ¥è¼¸å…¥)
        window.checkLoginInput = () => {
            // ä¿®æ­£ï¼šä¸å†æª¢æŸ¥ currentUserï¼Œå…è¨±å°šæœªé€£ç·šæ™‚ä¹Ÿèƒ½è§¸ç™¼ UI è®Šæ›´ (å¦‚é¡¯ç¤ºæŒ‰éˆ•)
            // if (!currentUser && !isDemoMode) return; 
            
            const t = document.getElementById('login-team').value.trim();
            const btn = document.getElementById('start-btn');
            
            if (!t) {
                btn.disabled = true;
                btn.className = "w-full bg-slate-700 text-slate-500 py-4 rounded-xl font-bold mt-4 transition-all shadow-lg";
                btn.innerText = "è«‹è¼¸å…¥å°çµ„åç¨±";
                return;
            }

            // ç›´æ¥æª¢æŸ¥ä»£ç¢¼ï¼Œé¿å… Async å•é¡Œ
            const isAdmin = (t === '880619');
            
            if (isAdmin) {
                window.userState.isAdmin = true;
                document.getElementById('role-selector').style.display = 'none';
                document.getElementById('role-selector').style.opacity = '0';
                btn.disabled = false;
                btn.className = "w-full bg-emerald-600 text-white py-4 rounded-xl font-bold mt-4 transition-all shadow-lg shadow-emerald-600/20 hover:bg-emerald-500";
                btn.innerHTML = `é€²å…¥æˆ°æƒ…å®¤ <i data-lucide="layout-dashboard" class="w-4 h-4 inline ml-1"></i>`;
                lucide.createIcons();
            } else {
                window.userState.isAdmin = false;
                document.getElementById('role-selector').style.display = 'block';
                document.getElementById('role-selector').style.opacity = '1';
                
                if (window.userState.role) {
                    btn.disabled = false;
                    btn.className = "w-full bg-emerald-600 text-white py-4 rounded-xl font-bold mt-4 transition-all shadow-lg shadow-emerald-600/20 hover:bg-emerald-500";
                    btn.innerText = "é–‹å§‹æ¨¡æ“¬";
                } else {
                    btn.disabled = true;
                    btn.className = "w-full bg-slate-700 text-slate-500 py-4 rounded-xl font-bold mt-4 transition-all shadow-lg";
                    btn.innerText = "è«‹é¸æ“‡è§’è‰²";
                }
            }
        };
        
        document.getElementById('login-team').addEventListener('input', checkLoginInput);

        // é€²å…¥æ¨¡æ“¬
        window.enterSimulation = async () => {
            const teamInput = document.getElementById('login-team').value.trim();
            
            // ä¿®æ­£ï¼šå¦‚æœå°šæœªé€£ç·šï¼Œé¡¯ç¤ºè¼‰å…¥ä¸­æç¤ºä¸¦å˜—è©¦å¼·åˆ¶é€²å…¥ (ä¾è³´ Demo Mode æˆ–ç­‰å¾…é€£ç·š)
            if (!currentUser && !isDemoMode) { 
                const btn = document.getElementById('start-btn');
                const originalText = btn.innerHTML;
                btn.innerText = "ç³»çµ±é€£ç·šä¸­...";
                
                // ç­‰å¾… 2 ç§’ï¼Œå¦‚æœé‚„æ˜¯æ²’é€£ä¸Šï¼Œåˆ‡æ›åˆ° Demo Mode
                await new Promise(r => setTimeout(r, 2000));
                
                if (!currentUser) {
                    console.warn("Force enabling demo mode for entry");
                    startDemoMode("Force Entry");
                }
            }
            
            document.getElementById('login-screen').style.opacity = '0';
            setTimeout(() => { document.getElementById('login-screen').style.display = 'none'; }, 500);

            if (window.userState.isAdmin) {
                initAdminDashboard();
            } else {
                window.userState.team = teamInput;
                initStudentView();
            }
        };

        // --- å­¸ç”Ÿç«¯é‚è¼¯ ---
        function initStudentView() {
            document.getElementById('main-student').classList.remove('hidden');
            document.getElementById('student-footer').classList.remove('hidden');
            const roleMap = { 'engineer':'ç’°å¢ƒå·¥ç¨‹å¸«', 'cfo':'è²¡å‹™é•·', 'pr':'å…¬é—œç¶“ç†', 'policy':'æ”¿ç­–åˆ†æå¸«', 'eco':'ç”Ÿæ…‹ä¿è‚²å“¡' };
            document.getElementById('header-team-info').innerText = `${window.userState.team} | ${roleMap[window.userState.role]}`;
            
            applyPermissions();
            startSync();
            // åˆå§‹è¨ˆç®—ä¸€æ¬¡
            calcScore();
        }

        function applyPermissions() {
            const r = window.userState.role;
            if (r !== 'engineer') lockUI('safety');
            if (r !== 'pr') lockUI('pr');
            if (r !== 'eco') lockUI('eco');
            if (r !== 'cfo') lockUI('cfo');
            if (r !== 'policy') {
                document.getElementById('lock-site').classList.remove('hidden');
                document.getElementById('lock-site').classList.add('flex');
            }
        }

        function lockUI(id) {
            const slider = document.getElementById(`slider-${id}`);
            if (slider) slider.disabled = true;
            const lockOverlay = document.getElementById(`lock-${id}`);
            if (lockOverlay) {
                lockOverlay.classList.remove('hidden');
                lockOverlay.classList.add('flex');
            }
        }

        // --- è€å¸«ç«¯é‚è¼¯ ---
        function initAdminDashboard() {
            document.getElementById('main-admin').classList.remove('hidden');
            
            if (isDemoMode) {
                // é›¢ç·šæ¨¡å¼ï¼šç”¢ç”Ÿæ¨¡æ“¬æ•¸æ“š
                const demoTeams = [
                    { id: 'ç¬¬ä¸€çµ„', site: 'A', safety: 3, pr: 2, eco: 2, cfo: 2, lastLog: 'å·²é€£ç·š', total: 78.5 },
                    { id: 'ç¬¬äºŒçµ„', site: 'B', safety: 4, pr: 4, eco: 3, cfo: 2, lastLog: 'èª¿æ•´åƒæ•¸ä¸­', total: 65.2 },
                    { id: 'ç¬¬ä¸‰çµ„', site: 'C', safety: 2, pr: 1, eco: 5, cfo: 4, lastLog: 'ç­‰å¾…ä¸­', total: 82.1 }
                ];
                let stats = { A:1, B:1, C:1, s:250, e:200, o:210 }; // Mock stats
                document.getElementById('admin-team-count').innerText = "3 (Demo)";
                updateAdminCharts(demoTeams, stats);
                renderTeamCards(demoTeams);
                renderLeaderboard(demoTeams);
                return;
            }

            // è·¯å¾‘ä¿®æ­£: artifacts/{appId}/public/data/sessions
            const q = collection(db, 'artifacts', appId, 'public', 'data', 'sessions');
            
            onSnapshot(q, (snapshot) => {
                const teams = [];
                let stats = { A:0, B:0, C:0, s:0, e:0, o:0 };
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const scores = calcScoreStatic(data);
                    // doc.id å³ç‚ºå°çµ„åç¨±
                    teams.push({ id: doc.id, ...data, ...scores });
                    
                    if(stats[data.site] !== undefined) stats[data.site]++;
                    stats.s += scores.s; stats.e += scores.e; stats.o += scores.o;
                });
                
                document.getElementById('admin-team-count').innerText = teams.length;
                updateAdminCharts(teams, stats);
                renderTeamCards(teams);
                renderLeaderboard(teams);
            }, (error) => {
                console.error("Admin sync error:", error);
                // Admin ä¹Ÿå¯ä»¥é™ç´šåˆ° Demo æ¨¡å¼é¡¯ç¤ºç©ºæ•¸æ“šæˆ–éŒ¯èª¤
                alert("ç„¡æ³•åŒæ­¥æ•¸æ“šï¼Œåˆ‡æ›è‡³æœ¬æ©Ÿæª¢è¦–æ¨¡å¼");
                // é€™è£¡å¯ä»¥è€ƒæ…®è‡ªå‹•åˆ‡æ›åˆ° Demo Mode ä¸¦é‡ç¹ª
            });
        }

        // Admin UI Helpers
        function renderTeamCards(teams) {
            const container = document.getElementById('team-cards');
            container.innerHTML = '';
            teams.forEach(t => {
                const siteIcon = t.site === 'A' ? 'ğŸŒŠ' : (t.site === 'B' ? 'ğŸ­' : 'â›°ï¸');
                const card = document.createElement('div');
                card.className = "bg-slate-800 p-4 rounded-xl border border-slate-700 hover:border-emerald-500 transition-colors cursor-default";
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-white truncate max-w-[120px]">${t.id}</span>
                        <span class="text-xs bg-slate-700 px-2 py-1 rounded">${siteIcon}</span>
                    </div>
                    <div class="flex justify-between text-xs text-slate-400 mb-2">
                        <span>SROI: <span class="text-emerald-400 font-bold text-lg">${t.total}</span></span>
                    </div>
                    <div class="w-full bg-slate-700 h-1.5 rounded-full overflow-hidden">
                        <div class="bg-emerald-500 h-full" style="width: ${Math.min(100, t.total)}%"></div>
                    </div>
                    <div class="text-[10px] text-slate-500 mt-2 truncate">
                        ${t.lastLog || 'ç­‰å¾…æ“ä½œ...'}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderLeaderboard(teams) {
            const list = document.getElementById('leaderboard');
            list.innerHTML = '';
            // æ’åºä¸¦å–å‰ 10
            teams.sort((a,b) => parseFloat(b.total) - parseFloat(a.total)).slice(0, 10).forEach((t, i) => {
                const row = document.createElement('div');
                row.className = "flex justify-between items-center bg-slate-700/50 p-2 rounded text-xs";
                row.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span class="font-bold ${i<3 ? 'text-yellow-400':'text-slate-500'} w-4">#${i+1}</span>
                        <span class="text-slate-300 truncate max-w-[100px]">${t.id}</span>
                    </div>
                    <span class="font-mono text-emerald-400 font-bold">${t.total}</span>
                `;
                list.appendChild(row);
            });
        }

        window.clearAllData = async () => {
            if (isDemoMode) { alert("é«”é©—æ¨¡å¼ç„¡æ³•åˆªé™¤æ•¸æ“š"); return; }
            if (!currentUser) return;
            if (confirm("âš ï¸ è­¦å‘Šï¼šé€™å°‡æœƒåˆªé™¤æ‰€æœ‰å°çµ„çš„é€²åº¦ï¼ç¢ºå®šè¦é‡ç½®å—ï¼Ÿ")) {
                try {
                    const q = collection(db, 'artifacts', appId, 'public', 'data', 'sessions');
                    const snapshot = await getDocs(q);
                    const batch = [];
                    snapshot.docs.forEach(doc => {
                        deleteDoc(doc.ref);
                    });
                    alert("èª²ç¨‹å·²é‡ç½®ï¼");
                } catch(e) {
                    alert("é‡ç½®å¤±æ•—ï¼š" + e.message);
                }
            }
        };

        // --- åŒæ­¥é‚è¼¯ (Sync Logic) ---
        function startSync() {
            if (isDemoMode) {
                // é›¢ç·šæ¨¡å¼ï¼šåªæ›´æ–° UIï¼Œä¸é€£ç·š
                addLog("é«”é©—æ¨¡å¼ï¼šè³‡æ–™åƒ…å„²å­˜æ–¼æœ¬åœ°");
                return;
            }
            if (!currentUser) return;
            // ä½¿ç”¨æ­£ç¢ºçš„å·¢ç‹€è·¯å¾‘
            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'sessions', window.userState.team);
            
            unsubscribe = onSnapshot(docRef, (snap) => {
                if(snap.exists()) {
                    const data = snap.data();
                    // åˆä½µé ç«¯æ•¸æ“šåˆ°æœ¬åœ°
                    window.teamState = { ...window.teamState, ...data };
                    updateUI(); 
                    calcScore(); 
                    if(data.lastLog && data.lastLog !== window.teamState.lastLogLocal) {
                        addLog(data.lastLog);
                        window.teamState.lastLogLocal = data.lastLog;
                    }
                } else {
                    // è‹¥æ–‡æª”ä¸å­˜åœ¨ï¼Œå‰µå»ºåˆå§‹ç‹€æ…‹
                    setDoc(docRef, window.teamState);
                }
            }, (error) => {
                console.error("Student sync error:", error);
                addLog("é€£ç·šä¸­æ–·ï¼Œåˆ‡æ›è‡³æœ¬åœ°æ¨¡å¼...");
                startDemoMode(error.message); // å‡ºéŒ¯æ™‚åˆ‡æ›åˆ° Demo
            });
        }

        window.updateTeamState = async (key, val) => {
            // æ›´æ–°æœ¬åœ°
            window.teamState[key] = val;
            calcScore();
            updateUI(); // ç¢ºä¿æœ¬åœ° UI å³æ™‚éŸ¿æ‡‰ (Optimistic UI)

            const roleMap = { 'engineer':'å·¥ç¨‹å¸«', 'cfo':'è²¡å‹™é•·', 'pr':'å…¬é—œ', 'policy':'åˆ†æå¸«', 'eco':'ç”Ÿæ…‹å“¡' };
            const logMsg = `${roleMap[window.userState.role]} èª¿æ•´äº†åƒæ•¸`;

            if (isDemoMode) {
                // é›¢ç·šæ¨¡å¼ï¼šåªè¨˜éŒ„ Log
                addLog(logMsg);
                return;
            }

            if (!currentUser) return;

            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'sessions', window.userState.team);
            
            try {
                await setDoc(docRef, { 
                    [key]: val, 
                    lastLog: logMsg, 
                    timestamp: serverTimestamp() 
                }, { merge: true });
            } catch (e) {
                console.error("Update failed:", e);
                // ä¸è·³ alert å¹²æ“¾æ“ä½œï¼Œåªåœ¨ log é¡¯ç¤º
                addLog("åŒæ­¥å¤±æ•— (é›¢ç·šä¸­)");
            }
        };

        function updateUI() {
            const s = window.teamState;
            // åªæœ‰ç•¶å…ƒç´ æœªè¢«é–å®šæ™‚æ‰æ›´æ–° valueï¼Œé¿å…å¹²æ“¾ä½¿ç”¨è€…æ‹–æ›³ (é›–ç„¶ Optimistic UI æœƒæ›´æ–°)
            // ä½†é€™è£¡ä¸»è¦ç”¨æ–¼æ¥æ”¶éšŠå‹çš„æ›´æ–°
            updateSliderIfNotDragging('safety', s.safety);
            updateSliderIfNotDragging('pr', s.pr);
            updateSliderIfNotDragging('eco', s.eco);
            updateSliderIfNotDragging('cfo', s.cfo);

            ['A','B','C'].forEach(site => {
                const btn = document.getElementById(`btn-${site}`);
                if (btn) {
                    if(site === s.site) btn.className = "site-card p-3 rounded-xl border-2 border-emerald-500 bg-emerald-50 ring-2 ring-emerald-200 text-center";
                    else btn.className = "site-card p-3 rounded-xl border-2 border-slate-100 text-center opacity-60 hover:opacity-100";
                }
            });
        }
        
        function updateSliderIfNotDragging(id, val) {
            const el = document.getElementById(`slider-${id}`);
            // å¦‚æœé€™æ˜¯ä½¿ç”¨è€…è‡ªå·±çš„è§’è‰²æ§åˆ¶çš„æ»‘æ¡¿ï¼Œä¸”æ­£åœ¨æ“ä½œä¸­ï¼Œå‰‡æš«ä¸å¾å¤–éƒ¨è¦†å¯«
            // é€™è£¡ç°¡åŒ–è™•ç†ï¼šç›´æ¥æ›´æ–°ï¼Œå› ç‚º oninput é »ç‡å¾ˆé«˜
            if (el) {
                el.value = val;
                const labels = ['ä½','åä½','æ¨™æº–','åé«˜','é«˜'];
                const txt = document.getElementById(`val-${id}`);
                if(txt) txt.innerText = labels[val-1] || 'æ¨™æº–';
            }
        }

        function addLog(msg) {
            const log = document.getElementById('system-log');
            const div = document.createElement('div');
            const time = new Date().toLocaleTimeString('zh-TW', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
            div.innerHTML = `<span class="text-slate-600">[${time}]</span> ${msg}`;
            log.prepend(div);
        }

        window.submitFinalDecision = async () => {
            const btn = document.getElementById('submit-btn');
            btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin mr-2"></i> å‚³é€ä¸­...`;
            lucide.createIcons();
            
            if (isDemoMode) {
                setTimeout(() => {
                    alert("ã€é«”é©—æ¨¡å¼ã€‘æ±ºç­–å·²é€å‡ºï¼(æœ¬åœ°æ¨¡æ“¬)");
                    btn.innerHTML = `å·²é€å‡º <i data-lucide="check" class="w-4 h-4 ml-1"></i>`;
                    btn.className = "bg-emerald-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg flex items-center gap-2 cursor-default";
                    btn.disabled = true;
                    lucide.createIcons();
                }, 800);
                return;
            }

            if (!currentUser) return;

            try {
                // è·¯å¾‘ä¿®æ­£: artifacts/{appId}/public/data/decisions
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'decisions'), {
                    site: window.teamState.site,
                    scores: calcScore(true),
                    user: window.userState.team,
                    timestamp: serverTimestamp()
                });
                alert("å·²é€å‡ºè‡³æˆ°æƒ…å®¤ï¼");
                btn.innerHTML = `å·²é€å‡º <i data-lucide="check" class="w-4 h-4 ml-1"></i>`;
                btn.className = "bg-emerald-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg flex items-center gap-2 cursor-default";
                btn.disabled = true;
                lucide.createIcons();
            } catch(e) { 
                console.error(e); 
                alert("ä¸Šå‚³å¤±æ•—ï¼š" + e.message); 
                btn.innerHTML = "æäº¤å¤±æ•— - è«‹é‡è©¦"; 
            }
        }

        // --- æ ¸å¿ƒç®—æ³• (Core Logic) ---
        const sites = { 'A': {s:85,e:20,o:95}, 'B': {s:50,e:95,o:15}, 'C': {s:70,e:60,o:55} };
        
        function calcScoreStatic(st) {
            // é˜²æ­¢æ•¸æ“šå°šæœªè¼‰å…¥
            if (!st || !st.site) return { s:0, e:0, o:0, total:0 };
            
            const base = sites[st.site] || sites['A'];
            const safety = parseInt(st.safety) || 3;
            const eco = parseInt(st.eco) || 2;
            const cfo = parseInt(st.cfo) || 2;
            const pr = parseInt(st.pr) || 2;

            let s = Math.min(100, Math.max(0, base.s + (safety * 5) + (eco * 2) - (cfo * 3)));
            if(st.site === 'B') s -= 10;
            
            let cost = (Math.pow(safety, 1.2)*3) + (pr * 5) + (eco * 4);
            let e = Math.min(100, Math.max(0, base.e + (cfo * 8) - cost));
            
            let o = Math.min(100, Math.max(0, base.o + (pr * 8) + (eco * 3) - (cfo * 2)));
            if(st.site === 'B' && s < 60) o -= 20;
            
            const total = ((s*0.4)+(e*0.25)+(o*0.35)).toFixed(1);
            return { s, e, o, total };
        }

        let chart;
        function calcScore(ret=false) {
            const res = calcScoreStatic(window.teamState);
            if(!ret) {
                document.getElementById('score-safety').innerText = parseInt(res.s);
                document.getElementById('score-economy').innerText = parseInt(res.e);
                document.getElementById('score-social').innerText = parseInt(res.o);
                document.getElementById('footer-score').innerText = res.total;
                if(chart) { 
                    chart.data.datasets[0].data = [res.s, res.e, res.o]; 
                    chart.update(); 
                }
            }
            return res;
        }

        let adminPie, adminBar;
        function updateAdminCharts(teams, stats) {
            const count = teams.length || 1;
            
            // Pie Chart
            if(!adminPie) {
                const ctx = document.getElementById('adminPieChart').getContext('2d');
                adminPie = new Chart(ctx, { 
                    type: 'doughnut', 
                    data: { 
                        labels: ['å¤–æµ·','å·¥æ¥­','æ·±å±±'], 
                        datasets:[{
                            data:[0,0,0], 
                            backgroundColor:['#3b82f6','#f59e0b','#10b981'], 
                            borderColor:'#1e293b',
                            borderWidth: 2
                        }] 
                    }, 
                    options: { 
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: '#cbd5e1' } } } 
                    } 
                });
            }
            adminPie.data.datasets[0].data = [stats.A, stats.B, stats.C]; 
            adminPie.update();

            // Bar Chart
            if(!adminBar) {
                const ctx = document.getElementById('adminBarChart').getContext('2d');
                adminBar = new Chart(ctx, { 
                    type: 'bar', 
                    data: { 
                        labels: ['å®‰å…¨','ç¶“æ¿Ÿ','ç¤¾æœƒ'], 
                        datasets:[{
                            label:'å…¨ç­å¹³å‡', 
                            data:[0,0,0], 
                            backgroundColor:['#3b82f6','#f59e0b','#10b981'],
                            borderRadius: 6
                        }] 
                    }, 
                    options: { 
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { 
                            y: { beginAtZero:true, max:100, grid:{color:'#334155'}, ticks:{color:'#94a3b8'} }, 
                            x: { grid:{display:false}, ticks:{color:'#94a3b8'} } 
                        }, 
                        plugins: { legend: { display:false } } 
                    } 
                });
            }
            adminBar.data.datasets[0].data = [stats.s/count, stats.e/count, stats.o/count]; 
            adminBar.update();
        }

        window.onload = () => {
            if(document.getElementById('radarChart')) {
                const ctx = document.getElementById('radarChart').getContext('2d');
                chart = new Chart(ctx, { 
                    type: 'radar', 
                    data: { 
                        labels: ['å®‰å…¨æ€§', 'ç¶“æ¿Ÿ', 'ç¤¾æœƒ'], 
                        datasets: [{ 
                            data: [50,50,50], 
                            backgroundColor: 'rgba(16,185,129,0.2)', 
                            borderColor: '#10b981', 
                            borderWidth: 2,
                            pointBackgroundColor: '#10b981'
                        }] 
                    }, 
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        scales: { 
                            r: { 
                                min: 0, 
                                max: 100, 
                                ticks: { display: false },
                                grid: { color: '#e2e8f0' },
                                angleLines: { color: '#e2e8f0' },
                                pointLabels: { font: { size: 12, weight: 'bold' }, color: '#64748b' }
                            } 
                        }, 
                        plugins: { legend: { display: false } } 
                    } 
                });
            }
            lucide.createIcons();
        };
    </script>
</body>
</html>
